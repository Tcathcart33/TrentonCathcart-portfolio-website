<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">    
    <title>PCB Smoker</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            color: #FFF;
            background: #000;
            overflow: hidden;
        }
        body {
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently supported by Chrome, Opera and Edge */
            font-family: 'Arial', sans-serif;
            text-align: center;
            background-image: url('Background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        .title {
            font-size: 4em;
            color: #E0FFFF;
            margin-top: 4%;
        }
        .temperature-info {
            font-size: 2em;
            color: #ffffff;
            text-shadow: 2px 2px 4px #000;
            background-image: url('Digital.png');
            background-size: 825px 120px;
            background-position: center;
            padding: 2px;
            border-radius: 15px;
            display: inline-block;
            width: 325px;
            text-align: center;
        }
        .temperature-display {
            font-size: 1.5em;
            color: #eb5b26;
            display: block;
        }
        .dial-container {
            display: flex; /* Using flexbox to center content */
            flex-direction: column; /* Stack children vertically */
            align-items: center; /* Center children horizontally */
            justify-content: center; /* Center children vertically */
            width: 400px; /* Adjust as necessary Must be same as Dial to center */
            height: 400px; /* Increased to accommodate the dial and temperature info */
            margin: auto;
            position: relative; /* Relative for absolute positioning of the dial */
        }
        .dial {
            background-image: url('Dial.png');
            background-size: cover;
            background-position: center;
            position: absolute;
            height: 400px;
            width: 100%;
            border-radius: 50%;
            margin-top: 20px;
            margin-bottom: 20px
        }
        .controls button {
            background-image: url('Button.jpg');
            background-size: 200px 90px;
            background-position: center;
            border: none;
            padding: 10px 20px;
            font-size: 1.2em;
            color: #FFF;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        .controls button:hover {
            color: #eb5b26;
        }
        .set-temperature-info {
            font-size: 2em;
            color: #ffffff;
            text-shadow: 2px 2px 4px #000;
            background-image: url('Digital.png');
            background-size: 1100px 200px;
            background-position: center;
            padding: 1px;
            border-radius: 20px;
            display: inline-block;
            width: 500px;
            text-align: center;
            margin-top: 575px;
        }
        .set-temperature-label, .temperature-setter {
            display: block;
            font-size: 1.5em;
            color: #ffffff;
            text-shadow: 2px 2px 4px #000;
            background: none;
            text-shadow: none;
            padding: 5px 0;
            margin: 0;
        }
        .temperature-setter {
            font-size: 2em;
            text-shadow: 2px 2px 4px #000;
            color: #eb5b26;
        }
    </style>
</head>
<body>
    <h1 class="title">PCB Smoker</h1>
    <div class="container">
        <div class="temperature-info">
            Current Temperature:
            <div id="current-temperature" class="temperature-display">250&deg;F</div>
        </div>
        <div class="controls">
            <button onclick="startSmoker()">Start Smoker</button>
            <button onclick="stopSmoker()">Stop Smoker</button>
        </div>
        <div class="dial-container">
            <div id="dial" class="dial" onmousedown="startDrag(event)"></div>
            <div class="set-temperature-info">
                <div class="set-temperature-label">Set Temperature:</div>
                <div id="set-temperature" class="temperature-setter">300&deg;F</div>
            </div>
        </div>
    </div>
    <script>
        var isDragging = false;
        var origin = { x: 0, y: 0 };
        var startAngle = 0;
        var currentAngle = 0; // Initialize to the start of your range
        var minAngle = -160; // Corresponding to 100째F on the dial
        var maxAngle = 160;  // Corresponding to 500째F on the dial
    
        // Helper function to determine the touch position
        function getTouchPosition(e) {
            if (e.touches && e.touches.length > 0) {
                return { x: e.touches[0].clientX, y: e.touches[0].clientY };
            }
            return { x: e.clientX, y: e.clientY };
        }
        function openFullscreen() {
            if (document.documentElement.requestFullscreen) {
              document.documentElement.requestFullscreen();
            } else if (document.documentElement.mozRequestFullScreen) { /* Firefox */
              document.documentElement.mozRequestFullScreen();
            } else if (document.documentElement.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
              document.documentElement.webkitRequestFullscreen();
            } else if (document.documentElement.msRequestFullscreen) { /* IE/Edge */
              document.documentElement.msRequestFullscreen();
            }
          }
          
          // Example for binding to a user action:
          document.getElementById('fullscreenButton').addEventListener('click', openFullscreen);
          
        function startDrag(e) {
            isDragging = true;
            origin = getTouchPosition(e);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
            document.addEventListener('touchmove', drag);
            document.addEventListener('touchend', stopDrag);
            startAngle = currentAngle;
        }
    
        function drag(e) {
            if (!isDragging) return;
            var pos = getTouchPosition(e);
            var dx = pos.x - origin.x;
            var dy = pos.y - origin.y;
            var radians = Math.atan2(dy, dx);
            var deltaAngle = radians * (180 / Math.PI);
            var newAngle = startAngle + deltaAngle;
            newAngle = Math.max(minAngle, Math.min(maxAngle, newAngle));
            currentAngle = newAngle;
            document.getElementById('dial').style.transform = 'rotate(' + currentAngle + 'deg)';
            setTemperature(mapValue(currentAngle, minAngle, maxAngle, 100, 500));
            e.preventDefault();
        }
    
        function stopDrag(e) {
            if (!isDragging) return;
            isDragging = false;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
            document.removeEventListener('touchmove', drag);
            document.removeEventListener('touchend', stopDrag);
            e.preventDefault();
        }
    
        function mapValue(value, start1, stop1, start2, stop2) {
            value = Math.max(start1, Math.min(stop1, value));
            var range = stop2 - start2;
            var scale = (stop1 - start1) / range;
            var temp = start2 + Math.round(((value - start1) / scale) / 5) * 5; // Change number 5 for value of indexing
            return temp;
        }
    

    
        var dial = document.getElementById('dial');
        dial.addEventListener('mousedown', startDrag);
        dial.addEventListener('touchstart', startDrag);
    </script>



    
    <script>
        document.addEventListener('wheel', function(event) {
            if (event.ctrlKey === true) {
                event.preventDefault();
            }
        }, { passive: false });
        
        // Fetch and display the current temperature
        function updateTemperature() {
            fetch('get_temperature.php')
                .then(response => response.json())
                .then(data => {
                    var tempDisplay = document.getElementById('current-temperature');
                    if (data.temperature && !data.temperature.startsWith('71.5')) {
                        tempDisplay.textContent = `${data.temperature}째F`;
                    } else {
                        tempDisplay.textContent = 'Error fetching temperature.';
                    }
                })
                .catch(error => {
                    console.error('Error fetching temperature:', error);
                    document.getElementById('current-temperature').textContent = '71.5째F';
                });
        }
        // Update the temperature display every 5 seconds
        setInterval(updateTemperature, 5000);
        // Initial temperature update
        updateTemperature();

        // Set the temperature display on the dial
        function setTemperature(temp) {
            var setTempDisplay = document.getElementById('set-temperature');
            setTempDisplay.textContent = Math.round(temp) + '째F';
            console.log('Setting temperature to:', temp);
        }
    
        // Start the smoker
        function startSmoker() {
            var setTemp = document.getElementById('dial').getAttribute('data-set-temp');
            fetch('control_servo.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'set_temp=' + setTemp
            })
            .then(response => response.text())
            .then(data => {
                console.log('Servo response:', data);
            })
            .catch(error => {
                console.error('Error starting smoker:', error);
            });
        }
    
        // Stop the smoker
        function stopSmoker() {
            console.log('Stopping smoker');
            // Add the code to stop the smoker here
        }
    
        // Initialize and set up the dial
        document.addEventListener('DOMContentLoaded', function() {
            var dial = document.getElementById('dial');
            dial.addEventListener('mousedown', startDrag);
            dial.addEventListener('touchstart', startDrag);
            // Other initialization code can go here
        });
    
        // Rest of the dial-related functions go here...
    
        // Attach event listeners to buttons
        document.querySelector('.start-button').addEventListener('click', startSmoker);
        document.querySelector('.stop-button').addEventListener('click', stopSmoker);
    
        // Rest of your existing JavaScript code...
    </script>
</body>
</html>

